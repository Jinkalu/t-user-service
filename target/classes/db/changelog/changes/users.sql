-- liquibase formatted sql
--changeset vishnu:change_0001

CREATE EXTENSION IF NOT EXISTS citext;

CREATE TABLE user_permission (
  permission_id BIGINT NOT NULL,
  users_id BIGINT NOT NULL,
  CONSTRAINT pk_user_permission PRIMARY KEY (permission_id, users_id)
);

CREATE TABLE users (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  user_uid UUID NOT NULL,
  firstname VARCHAR(255),
  lastname VARCHAR(255),
  username VARCHAR(255),
  account_type SMALLINT,
  email VARCHAR(255) NOT NULL,
  mobile VARCHAR(255),
  password VARCHAR(255),
  gender SMALLINT,
  dob BIGINT,
  bio citext,
  profile_picture VARCHAR(255),
  cover_picture VARCHAR(255),
  city_id BIGINT,
  is_verified BOOLEAN,
  location VARCHAR(255),
  status SMALLINT NOT NULL,
  is_social_account BOOLEAN,
  social_type SMALLINT,
  password_updated_at BIGINT,
  last_sign_in_at BIGINT,
  address VARCHAR(255),
  website VARCHAR(255),
  custom_badge VARCHAR(255),
  verification_type SMALLINT,
  is_private BOOLEAN,
  social_login_password VARCHAR(255),
  platform_password VARCHAR(255),
  user_role_id BIGINT,
  country_id BIGINT,
   created_at BIGINT,
   updated_at BIGINT,
   created_by VARCHAR(255),
   updated_by VARCHAR(255),
  CONSTRAINT pk_users PRIMARY KEY (id)
);

ALTER TABLE users ADD CONSTRAINT uc_users_username UNIQUE (username);

ALTER TABLE users ADD CONSTRAINT uc_users_user_uid UNIQUE (user_uid);

ALTER TABLE users ADD CONSTRAINT fk_users_on_country FOREIGN KEY (country_id) REFERENCES country (id);

ALTER TABLE users ADD CONSTRAINT fk_users_on_user_role FOREIGN KEY (user_role_id) REFERENCES role (id);

ALTER TABLE user_permission ADD CONSTRAINT fk_user_permission_on_permission FOREIGN KEY (permission_id) REFERENCES permission (id);

ALTER TABLE user_permission ADD CONSTRAINT fk_user_permission_on_users FOREIGN KEY (users_id) REFERENCES users (id);


